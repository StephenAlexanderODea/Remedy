<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Remedy ‚Äî Family Health Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f7f4ef;--surface:#fff;--surface2:#f0ece4;--border:#e5dfd4;--accent:#2d6a4f;--accent2:#40916c;--accent-light:#d8f3dc;--gold:#e07b39;--gold-light:#fdebd0;--red:#c0392b;--red-light:#fde8e6;--blue:#2471a3;--blue-light:#d6eaf8;--purple:#7c3aed;--purple-light:#ede9fe;--teal:#0e7490;--teal-light:#cffafe;--text:#1a1a1a;--text2:#5a5a5a;--text3:#999;--radius:16px}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);font-family:'DM Sans',sans-serif;color:var(--text);min-height:100vh}
.app-header{background:var(--surface);border-bottom:1px solid var(--border);padding:0 24px;display:flex;align-items:center;justify-content:space-between;height:64px;position:sticky;top:0;z-index:50}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:36px;height:36px;background:var(--accent);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px}
.logo-text{font-family:'DM Serif Display',serif;font-size:20px}.logo-text span{color:var(--accent)}
.date-chip{background:var(--surface2);border:1px solid var(--border);border-radius:20px;padding:6px 14px;font-size:13px;font-weight:500;color:var(--text2)}
.main{max-width:1100px;margin:0 auto;padding:28px 20px}
.page{display:none}.page.active{display:block}
.tabs{display:flex;gap:4px;background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:4px;margin-bottom:28px;width:fit-content;flex-wrap:wrap}
.tab{padding:8px 16px;border-radius:9px;font-size:13px;font-weight:500;cursor:pointer;border:none;background:none;color:var(--text2);font-family:'DM Sans',sans-serif;transition:.2s}
.tab.active{background:var(--surface);color:var(--accent);font-weight:600;box-shadow:0 1px 4px rgba(0,0,0,.08)}
.section-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:18px;gap:12px;flex-wrap:wrap}
.section-title{font-family:'DM Serif Display',serif;font-size:22px}.section-sub{font-size:13px;color:var(--text3);margin-top:2px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:9px 18px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;border:none;font-family:'DM Sans',sans-serif;transition:.2s}
.btn-primary{background:var(--accent);color:#fff}.btn-primary:hover{background:var(--accent2);transform:translateY(-1px)}
.btn-secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border)}.btn-secondary:hover{border-color:var(--accent);color:var(--accent)}
.btn-sm{padding:6px 12px;font-size:12px;border-radius:8px}
.btn-remind{background:var(--gold-light);color:var(--gold);border:1px solid #f5c6a0}.btn-remind:hover{background:#fad4a8}
.btn-danger{background:var(--red-light);color:var(--red);border:1px solid #f5b7b1}
.stats-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:12px;margin-bottom:28px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px}
.stat-num{font-family:'DM Serif Display',serif;font-size:26px;margin-bottom:3px}.stat-label{font-size:12px;color:var(--text3);font-weight:500}
.stat-card.green .stat-num{color:var(--accent)}.stat-card.gold .stat-num{color:var(--gold)}.stat-card.red .stat-num{color:var(--red)}.stat-card.blue .stat-num{color:var(--blue)}
.family-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-bottom:32px}
.member-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:.2s;cursor:pointer}
.member-card:hover{box-shadow:0 4px 20px rgba(0,0,0,.08);transform:translateY(-2px)}
.member-card-header{padding:18px 20px 14px;display:flex;align-items:center;gap:14px}
.avatar{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.member-name{font-size:16px;font-weight:600;margin-bottom:2px}.member-role{font-size:12px;color:var(--text3);font-weight:500}
.status-badge{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.04em;white-space:nowrap}
.status-all{background:var(--accent-light);color:var(--accent)}.status-pending{background:var(--gold-light);color:var(--gold)}.status-missed{background:var(--red-light);color:var(--red)}
.med-progress{padding:0 20px 12px}.progress-label{display:flex;justify-content:space-between;font-size:12px;color:var(--text3);margin-bottom:6px}
.progress-bar{height:5px;background:var(--surface2);border-radius:3px;overflow:hidden}.progress-fill{height:100%;border-radius:3px;transition:width .4s}
.progress-fill.green{background:var(--accent)}.progress-fill.yellow{background:var(--gold)}.progress-fill.red{background:var(--red)}
.med-pills{padding:0 20px 10px;display:flex;flex-wrap:wrap;gap:5px}
.med-pill{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:500;border:1px solid var(--border);background:var(--surface2);color:var(--text2)}
.med-pill.taken{background:var(--accent-light);border-color:#b7e4c7;color:var(--accent)}
.card-strip{padding:0 20px 10px;display:flex;flex-direction:column;gap:5px}
.strip-item{display:flex;align-items:center;gap:7px;font-size:12px;color:var(--text2)}
.strip-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.card-actions{padding:12px 20px;border-top:1px solid var(--border);display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.urgency-dot{width:7px;height:7px;border-radius:50%;display:inline-block}
.urgency-dot.high{background:var(--red);animation:pulse 1.5s infinite}.urgency-dot.medium{background:var(--gold)}.urgency-dot.low{background:var(--accent)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.detail-header{display:flex;align-items:center;gap:14px;margin-bottom:22px;flex-wrap:wrap}
.back-btn{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px 14px;font-size:14px;font-weight:600;cursor:pointer;color:var(--text2);font-family:'DM Sans',sans-serif;transition:.2s}
.back-btn:hover{color:var(--accent);border-color:var(--accent)}
.detail-info h2{font-family:'DM Serif Display',serif;font-size:22px}.detail-info p{font-size:13px;color:var(--text3);margin-top:2px}
.detail-tabs{display:flex;gap:3px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:3px;margin-bottom:20px;width:fit-content;flex-wrap:wrap}
.detail-tab{padding:7px 14px;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;border:none;background:none;color:var(--text2);font-family:'DM Sans',sans-serif;transition:.2s}
.detail-tab.active{background:var(--surface);color:var(--accent);font-weight:600;box-shadow:0 1px 3px rgba(0,0,0,.07)}
.detail-section{display:none}.detail-section.active{display:block}
.subsection-label{font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.07em;margin-bottom:12px}
.med-list{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}
.med-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 18px;display:flex;align-items:center;gap:12px}
.med-item.taken-item{background:#f8fffe;border-color:#b7e4c7}
.med-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0}
.med-icon.blue{background:var(--blue-light)}.med-icon.green{background:var(--accent-light)}.med-icon.gold{background:var(--gold-light)}.med-icon.red{background:var(--red-light)}.med-icon.purple{background:var(--purple-light)}
.med-details{flex:1}.med-name{font-size:15px;font-weight:600;margin-bottom:3px}.med-meta{font-size:12px;color:var(--text3);display:flex;gap:10px;flex-wrap:wrap}
.time-badge{background:var(--blue-light);color:var(--blue);border:1px solid #aed6f1;border-radius:8px;padding:3px 9px;font-size:12px;font-weight:600;white-space:nowrap}
.time-badge.urgent{background:var(--red-light);color:var(--red);border-color:#f5b7b1;animation:pulse 2s infinite}
.check-btn{width:34px;height:34px;border-radius:10px;border:2px solid var(--border);background:var(--surface2);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:15px;transition:.2s;flex-shrink:0}
.check-btn:hover{border-color:var(--accent);background:var(--accent-light)}.check-btn.checked{background:var(--accent);border-color:var(--accent);color:#fff}
.appt-list{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}
.appt-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px 18px;display:flex;align-items:flex-start;gap:14px}
.appt-card.upcoming{border-left:3px solid var(--blue)}.appt-card.today{border-left:3px solid var(--gold)}.appt-card.past{border-left:3px solid var(--border);opacity:.7}
.date-block{border-radius:10px;padding:8px 12px;text-align:center;min-width:50px;flex-shrink:0}
.date-block.normal{background:var(--blue-light)}.date-block.today{background:var(--gold-light)}
.date-day{font-size:20px;font-weight:700;line-height:1}.date-day.normal{color:var(--blue)}.date-day.today-c{color:var(--gold)}
.date-mon{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-top:2px}.date-mon.normal{color:var(--blue)}.date-mon.today-c{color:var(--gold)}
.appt-info{flex:1}.appt-title{font-size:15px;font-weight:600;margin-bottom:4px}.appt-meta{font-size:12px;color:var(--text3);display:flex;gap:10px;flex-wrap:wrap}
.appt-tag{display:inline-block;padding:2px 9px;border-radius:20px;font-size:11px;font-weight:600}
.appt-tag.blue{background:var(--blue-light);color:var(--blue)}.appt-tag.green{background:var(--accent-light);color:var(--accent)}.appt-tag.gold{background:var(--gold-light);color:var(--gold)}.appt-tag.purple{background:var(--purple-light);color:var(--purple)}.appt-tag.teal{background:var(--teal-light);color:var(--teal)}
.refill-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 18px;display:flex;align-items:center;gap:12px;margin-bottom:10px}
.refill-item.low{border-color:#f5c6a0;background:#fffdf9}.refill-item.critical{border-color:#f5b7b1;background:#fff8f8}
.refill-num{font-size:22px;font-weight:700;min-width:36px;text-align:right}
.refill-num.ok{color:var(--accent)}.refill-num.low{color:var(--gold)}.refill-num.critical{color:var(--red)}
.allergy-list{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px}
.allergy-card{background:var(--surface);border:1px solid #f5b7b1;border-radius:12px;padding:12px 16px;display:flex;align-items:center;gap:10px}
.sev-badge{padding:2px 8px;border-radius:20px;font-size:11px;font-weight:700}
.sev-badge.severe{background:var(--red-light);color:var(--red)}.sev-badge.moderate{background:var(--gold-light);color:var(--gold)}.sev-badge.mild{background:var(--accent-light);color:var(--accent)}
.vitals-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;margin-bottom:20px}
.vital-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px 15px}
.vital-val{font-size:19px;font-weight:700;color:var(--blue);margin-bottom:2px}.vital-lbl{font-size:11px;color:var(--text3);font-weight:500}.vital-date{font-size:10px;color:var(--text3);margin-top:4px}
.notes-list{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}
.note-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:15px 18px}
.note-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px;gap:8px;flex-wrap:wrap}
.note-title-text{font-size:14px;font-weight:600}.note-date{font-size:11px;color:var(--text3)}.note-body{font-size:13px;color:var(--text2);line-height:1.6}
.banner{background:linear-gradient(135deg,#e3f2fd,#e8f5e9);border:1px solid #b3d9f5;border-radius:14px;padding:14px 18px;margin-bottom:18px;display:flex;align-items:flex-start;gap:12px}
.banner-icon{font-size:22px;flex-shrink:0}.banner-text{font-size:13px;color:var(--text2);line-height:1.6}
.info-box{background:var(--blue-light);border:1px solid #aed6f1;border-radius:12px;padding:13px 16px;font-size:13px;color:var(--blue);margin-bottom:16px;line-height:1.5}
.divider{height:1px;background:var(--border);margin:16px 0}
.empty{text-align:center;padding:32px 20px;color:var(--text3)}.empty-icon{font-size:36px;margin-bottom:10px}.empty h4{font-size:15px;font-weight:600;color:var(--text2);margin-bottom:5px}.empty p{font-size:13px}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);backdrop-filter:blur(4px);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex}
.modal{background:var(--surface);border-radius:20px;padding:28px;width:100%;max-width:460px;box-shadow:0 20px 60px rgba(0,0,0,.2);animation:modalIn .25s ease;max-height:90vh;overflow-y:auto}
@keyframes modalIn{from{opacity:0;transform:scale(.95) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal h3{font-family:'DM Serif Display',serif;font-size:20px;margin-bottom:20px}
.form-group{margin-bottom:14px}.form-label{font-size:13px;font-weight:600;color:var(--text2);margin-bottom:5px;display:block}
.form-input,.form-select,.form-textarea{width:100%;padding:10px 14px;border:1px solid var(--border);border-radius:10px;font-size:14px;font-family:'DM Sans',sans-serif;color:var(--text);background:var(--surface);outline:none;transition:border-color .2s}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--accent)}
.form-textarea{resize:vertical;min-height:72px}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.modal-actions{display:flex;gap:10px;margin-top:18px}
.toast{position:fixed;bottom:24px;right:24px;background:#1a1a1a;color:#fff;padding:13px 18px;border-radius:12px;font-size:14px;font-weight:500;display:flex;align-items:center;gap:10px;box-shadow:0 8px 30px rgba(0,0,0,.2);z-index:999;transform:translateY(80px);opacity:0;transition:all .3s;max-width:300px}
.toast.show{transform:translateY(0);opacity:1}
</style>
</head>
<body>

<div class="app-header">
  <div class="logo">
    <div class="logo-icon">üíä</div>
    <div class="logo-text">Remedy</div>
  </div>
  <div style="display:flex;align-items:center;gap:10px">
    <div class="date-chip" id="date-chip"></div>
    <button class="btn btn-primary btn-sm" onclick="openAddMember()">+ Add Member</button>
  </div>
</div>

<div class="main">
  <div class="tabs">
    <button class="tab active" onclick="switchMain('dashboard',this)">üè† Family Dashboard</button>
    <button class="tab" onclick="switchMain('detail',this)" id="detail-tab" style="display:none">üë§ Member Detail</button>
    <button class="tab" onclick="switchMain('appointments',this)">üìÖ All Appointments</button>
  </div>

  <!-- DASHBOARD -->
  <div class="page active" id="page-dashboard">
    <div class="section-top">
      <div><div class="section-title">Family Overview</div><div class="section-sub">Today's health status for every member</div></div>
    </div>
    <div id="banner-area"></div>
    <div class="stats-row" id="stats-row"></div>
    <div class="family-grid" id="family-grid"></div>
  </div>

  <!-- DETAIL -->
  <div class="page" id="page-detail">
    <div class="detail-header">
      <button class="back-btn" onclick="goBack()">‚Üê Back</button>
      <div id="detail-avatar-wrap"></div>
      <div class="detail-info">
        <h2 id="detail-name"></h2>
        <p id="detail-sub"></p>
      </div>
    </div>
    <div class="detail-tabs">
      <button class="detail-tab active" onclick="switchDetail('meds',this)">üíä Medications</button>
      <button class="detail-tab" onclick="switchDetail('appts',this)">ü©∫ Appointments</button>
      <button class="detail-tab" onclick="switchDetail('refills',this)">üîÑ Refills</button>
      <button class="detail-tab" onclick="switchDetail('allergies',this)">‚ö†Ô∏è Allergies</button>
      <button class="detail-tab" onclick="switchDetail('notes',this)">üìã Health Notes</button>
    </div>
    <div class="detail-section active" id="ds-meds">
      <div class="section-top"><div class="subsection-label">Today's Medications</div><button class="btn btn-primary btn-sm" onclick="openAddMed()">+ Add Medication</button></div>
      <div id="detail-med-list"></div>
    </div>
    <div class="detail-section" id="ds-appts">
      <div class="section-top"><div class="subsection-label">Doctor's Appointments</div><button class="btn btn-primary btn-sm" onclick="openAddAppt()">+ Add Appointment</button></div>
      <div id="detail-appt-list"></div>
    </div>
    <div class="detail-section" id="ds-refills">
      <div class="info-box">üí° Track days of supply so you never run out. Add supply count when adding a medication.</div>
      <div class="section-top"><div class="subsection-label">Refill Tracker</div><button class="btn btn-primary btn-sm" onclick="openAddMed()">+ Add Medication</button></div>
      <div id="detail-refill-list"></div>
    </div>
    <div class="detail-section" id="ds-allergies">
      <div class="section-top"><div class="subsection-label">Known Allergies</div><button class="btn btn-primary btn-sm" onclick="openAddAllergy()">+ Add Allergy</button></div>
      <div id="detail-allergy-list"></div>
    </div>
    <div class="detail-section" id="ds-notes">
      <div class="section-top"><div class="subsection-label">Vitals & Health Notes</div><button class="btn btn-primary btn-sm" onclick="openAddNote()">+ Add Note</button></div>
      <div class="vitals-grid" id="detail-vitals"></div>
      <div class="subsection-label" style="margin-top:4px">Notes</div>
      <div id="detail-notes-list"></div>
    </div>
  </div>

  <!-- ALL APPOINTMENTS -->
  <div class="page" id="page-appointments">
    <div class="section-top"><div><div class="section-title">All Appointments</div><div class="section-sub">Every upcoming & past appointment across the family</div></div></div>
    <div id="all-appts-list"></div>
  </div>
</div>

<!-- ADD MEMBER -->
<div class="modal-overlay" id="modal-member" onclick="if(event.target===this)closeModal('modal-member')">
  <div class="modal">
    <h3>Add Family Member</h3>
    <div class="form-group"><label class="form-label">Name</label><input class="form-input" id="nm-name" placeholder="e.g. Dad, Grandma, Sarah..."/></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Role</label><select class="form-select" id="nm-role"><option>Parent</option><option>Child</option><option>Grandparent</option><option>Spouse</option><option>Other</option></select></div>
      <div class="form-group"><label class="form-label">Avatar</label><select class="form-select" id="nm-avatar"><option value="üë®">üë® Man</option><option value="üë©">üë© Woman</option><option value="üë¥">üë¥ Older Man</option><option value="üëµ">üëµ Older Woman</option><option value="üë¶">üë¶ Boy</option><option value="üëß">üëß Girl</option><option value="üßë">üßë Person</option></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-primary" style="flex:1" onclick="addMember()">Add Member</button><button class="btn btn-secondary" onclick="closeModal('modal-member')">Cancel</button></div>
  </div>
</div>

<!-- ADD MED -->
<div class="modal-overlay" id="modal-med" onclick="if(event.target===this)closeModal('modal-med')">
  <div class="modal">
    <h3>Add Medication</h3>
    <div class="form-group"><label class="form-label">Medication Name</label><input class="form-input" id="med-name" placeholder="e.g. Lisinopril, Vitamin D..."/></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Dosage</label><input class="form-input" id="med-dose" placeholder="e.g. 10mg"/></div>
      <div class="form-group"><label class="form-label">Days of Supply Left</label><input class="form-input" id="med-supply" type="number" placeholder="e.g. 30"/></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Frequency</label><select class="form-select" id="med-freq"><option>Once daily</option><option>Twice daily</option><option>Three times daily</option><option>With meals</option><option>As needed</option><option>Weekly</option></select></div>
      <div class="form-group"><label class="form-label">Time</label><input class="form-input" id="med-time" type="time"/></div>
    </div>
    <div class="form-group"><label class="form-label">Time Sensitive?</label><select class="form-select" id="med-urgent"><option value="low">No ‚Äî flexible timing</option><option value="medium">Somewhat ‚Äî take around this time</option><option value="high">Yes ‚Äî must take on time</option></select></div>
    <div class="form-group"><label class="form-label">Prescribing Doctor (optional)</label><input class="form-input" id="med-doctor" placeholder="e.g. Dr. Smith"/></div>
    <div class="modal-actions"><button class="btn btn-primary" style="flex:1" onclick="addMed()">Add Medication</button><button class="btn btn-secondary" onclick="closeModal('modal-med')">Cancel</button></div>
  </div>
</div>

<!-- ADD APPOINTMENT -->
<div class="modal-overlay" id="modal-appt" onclick="if(event.target===this)closeModal('modal-appt')">
  <div class="modal">
    <h3>Add Appointment</h3>
    <div class="form-group"><label class="form-label">Appointment Type</label><input class="form-input" id="appt-title" placeholder="e.g. Annual Checkup, Cardiology Follow-up..."/></div>
    <div class="form-group"><label class="form-label">Doctor / Specialist</label><input class="form-input" id="appt-doctor" placeholder="e.g. Dr. Johnson"/></div>
    <div class="form-group"><label class="form-label">Location / Clinic</label><input class="form-input" id="appt-location" placeholder="e.g. Texas Medical Center"/></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Date</label><input class="form-input" id="appt-date" type="date"/></div>
      <div class="form-group"><label class="form-label">Time</label><input class="form-input" id="appt-time" type="time"/></div>
    </div>
    <div class="form-group"><label class="form-label">Category</label><select class="form-select" id="appt-type"><option value="checkup">Checkup</option><option value="specialist">Specialist</option><option value="follow-up">Follow-up</option><option value="lab">Lab Work</option><option value="dental">Dental</option><option value="vision">Vision</option><option value="mental">Mental Health</option><option value="other">Other</option></select></div>
    <div class="form-group"><label class="form-label">Notes (optional)</label><textarea class="form-textarea" id="appt-notes" placeholder="Bring insurance card, fasting required..."></textarea></div>
    <div class="modal-actions"><button class="btn btn-primary" style="flex:1" onclick="addAppt()">Add Appointment</button><button class="btn btn-secondary" onclick="closeModal('modal-appt')">Cancel</button></div>
  </div>
</div>

<!-- ADD ALLERGY -->
<div class="modal-overlay" id="modal-allergy" onclick="if(event.target===this)closeModal('modal-allergy')">
  <div class="modal">
    <h3>Add Allergy</h3>
    <div class="form-group"><label class="form-label">Allergen</label><input class="form-input" id="al-name" placeholder="e.g. Penicillin, Peanuts, Latex..."/></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Severity</label><select class="form-select" id="al-sev"><option value="severe">Severe ‚Äî anaphylaxis risk</option><option value="moderate">Moderate</option><option value="mild">Mild</option></select></div>
      <div class="form-group"><label class="form-label">Reaction</label><input class="form-input" id="al-reaction" placeholder="e.g. Hives, Swelling..."/></div>
    </div>
    <div class="modal-actions"><button class="btn btn-primary" style="flex:1" onclick="addAllergy()">Add Allergy</button><button class="btn btn-secondary" onclick="closeModal('modal-allergy')">Cancel</button></div>
  </div>
</div>

<!-- ADD NOTE -->
<div class="modal-overlay" id="modal-note" onclick="if(event.target===this)closeModal('modal-note')">
  <div class="modal">
    <h3>Add Health Note</h3>
    <div class="form-group"><label class="form-label">Title</label><input class="form-input" id="nt-title" placeholder="e.g. Blood Pressure Reading, Doctor Visit Summary..."/></div>
    <div class="form-group"><label class="form-label">Note</label><textarea class="form-textarea" id="nt-body" placeholder="Enter details..."></textarea></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Vital Type (optional)</label><select class="form-select" id="nt-vital-type"><option value="">None</option><option value="bp">Blood Pressure</option><option value="weight">Weight</option><option value="sugar">Blood Sugar</option><option value="temp">Temperature</option><option value="pulse">Heart Rate</option><option value="o2">Oxygen Sat</option></select></div>
      <div class="form-group"><label class="form-label">Value</label><input class="form-input" id="nt-vital-val" placeholder="e.g. 120/80, 165 lbs..."/></div>
    </div>
    <div class="modal-actions"><button class="btn btn-primary" style="flex:1" onclick="addNote()">Save Note</button><button class="btn btn-secondary" onclick="closeModal('modal-note')">Cancel</button></div>
  </div>
</div>

<div class="toast" id="toast"><span id="t-icon">üîî</span><span id="t-msg">Done!</span></div>

<script>
const today = new Date();
document.getElementById('date-chip').textContent = today.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});

let nid = 500;
let currentMember = null;

let members = [
  { id:1, name:"Dad", role:"Parent", avatar:"üë®", color:"#dbeafe",
    meds:[
      {id:1,name:"Lisinopril",dose:"10mg",freq:"Once daily",time:"08:00",urgent:"high",taken:false,supply:12,doctor:"Dr. Patel"},
      {id:2,name:"Metformin",dose:"500mg",freq:"Twice daily",time:"08:00",urgent:"medium",taken:true,supply:28,doctor:"Dr. Patel"},
      {id:3,name:"Vitamin D",dose:"1000 IU",freq:"Once daily",time:"",urgent:"low",taken:false,supply:45,doctor:""},
    ],
    appointments:[
      {id:1,title:"Cardiology Follow-up",doctor:"Dr. Chen",location:"Texas Heart Institute",date:"2026-02-20",time:"10:00",type:"specialist",notes:"Bring last EKG results"},
      {id:2,title:"Annual Physical",doctor:"Dr. Patel",location:"Family Care Clinic",date:"2026-04-15",time:"09:00",type:"checkup",notes:"Fasting required"},
    ],
    allergies:[
      {id:1,name:"Penicillin",severity:"severe",reaction:"Anaphylaxis"},
      {id:2,name:"Sulfa Drugs",severity:"moderate",reaction:"Rash"},
    ],
    notes:[
      {id:1,title:"Blood Pressure Reading",body:"Slightly elevated this morning.",date:"Feb 10",vType:"bp",vVal:"138/88"},
      {id:2,title:"Doctor Visit Notes",body:"Dr. Patel recommends reducing sodium and increasing cardio.",date:"Jan 22",vType:"",vVal:""},
    ]
  },
  { id:2, name:"Mom", role:"Parent", avatar:"üë©", color:"#fde8f5",
    meds:[
      {id:1,name:"Levothyroxine",dose:"50mcg",freq:"Once daily",time:"07:00",urgent:"high",taken:true,supply:30,doctor:"Dr. Williams"},
      {id:2,name:"Calcium",dose:"500mg",freq:"Twice daily",time:"12:00",urgent:"low",taken:true,supply:60,doctor:""},
    ],
    appointments:[
      {id:1,title:"Endocrinology",doctor:"Dr. Williams",location:"Memorial Hermann",date:"2026-02-15",time:"14:30",type:"specialist",notes:"Thyroid panel results ready"},
    ],
    allergies:[],
    notes:[{id:1,title:"Weight Check",body:"Routine monthly tracking.",date:"Feb 12",vType:"weight",vVal:"142 lbs"}]
  },
  { id:3, name:"Grandpa", role:"Grandparent", avatar:"üë¥", color:"#d8f3dc",
    meds:[
      {id:1,name:"Aspirin",dose:"81mg",freq:"Once daily",time:"09:00",urgent:"high",taken:false,supply:7,doctor:"Dr. Rodriguez"},
      {id:2,name:"Atorvastatin",dose:"20mg",freq:"Once daily",time:"21:00",urgent:"medium",taken:false,supply:14,doctor:"Dr. Rodriguez"},
      {id:3,name:"Amlodipine",dose:"5mg",freq:"Once daily",time:"09:00",urgent:"high",taken:false,supply:3,doctor:"Dr. Rodriguez"},
    ],
    appointments:[
      {id:1,title:"Lab Work ‚Äî Cholesterol Panel",doctor:"",location:"Quest Diagnostics",date:"2026-02-17",time:"08:00",type:"lab",notes:"Fasting 12 hours before"},
      {id:2,title:"Cardiology Checkup",doctor:"Dr. Rodriguez",location:"Houston Methodist",date:"2026-02-18",time:"11:00",type:"specialist",notes:"Bring medication list"},
    ],
    allergies:[{id:1,name:"Ibuprofen",severity:"moderate",reaction:"GI Bleeding"}],
    notes:[
      {id:1,title:"Blood Pressure",body:"Taken after morning meds.",date:"Feb 13",vType:"bp",vVal:"145/92"},
      {id:2,title:"Blood Sugar",body:"Fasting glucose check.",date:"Feb 13",vType:"sugar",vVal:"118 mg/dL"},
    ]
  },
  { id:4, name:"Sarah", role:"Child", avatar:"üëß", color:"#fef9c3",
    meds:[{id:1,name:"Amoxicillin",dose:"250mg",freq:"Three times daily",time:"08:00",urgent:"high",taken:true,supply:8,doctor:"Dr. Kim"}],
    appointments:[{id:1,title:"Pediatric Follow-up",doctor:"Dr. Kim",location:"Texas Children's",date:"2026-02-19",time:"15:00",type:"follow-up",notes:"Check ear infection recovery"}],
    allergies:[],
    notes:[]
  },
];

function fmtTime(t){if(!t)return null;const[h,m]=t.split(':').map(Number);return`${h%12||12}:${m.toString().padStart(2,'0')} ${h>=12?'PM':'AM'}`}
function daysUntil(d){const dt=new Date(d+'T12:00:00');return Math.round((dt-today)/(86400000))}
function getMedStatus(m){const t=m.meds.length;if(!t)return'none';const tk=m.meds.filter(x=>x.taken).length;return tk===t?'all':tk===0?'missed':'pending'}
function tagInfo(t){const mp={checkup:{c:'green',l:'Checkup'},specialist:{c:'blue',l:'Specialist'},'follow-up':{c:'blue',l:'Follow-up'},lab:{c:'purple',l:'Lab Work'},dental:{c:'teal',l:'Dental'},vision:{c:'teal',l:'Vision'},mental:{c:'purple',l:'Mental Health'},other:{c:'gold',l:'Appointment'}};return mp[t]||{c:'gold',l:'Appointment'}}
const vIcons={bp:'‚ù§Ô∏è',weight:'‚öñÔ∏è',sugar:'ü©∏',temp:'üå°Ô∏è',pulse:'üíì',o2:'ü´Å'};
const vLabels={bp:'Blood Pressure',weight:'Weight',sugar:'Blood Sugar',temp:'Temperature',pulse:'Heart Rate',o2:'O2 Sat'};

// ‚îÄ‚îÄ STATS ‚îÄ‚îÄ
function renderStats(){
  const tMeds=members.reduce((a,m)=>a+m.meds.length,0);
  const tTaken=members.reduce((a,m)=>a+m.meds.filter(x=>x.taken).length,0);
  const tAppts=members.reduce((a,m)=>a+m.appointments.filter(x=>{const d=daysUntil(x.date);return d>=0&&d<=7}).length,0);
  const tRefills=members.reduce((a,m)=>a+m.meds.filter(x=>x.supply!=null&&x.supply<=14).length,0);
  document.getElementById('stats-row').innerHTML=`
    <div class="stat-card green"><div class="stat-num">${tTaken}</div><div class="stat-label">Doses Taken Today</div></div>
    <div class="stat-card gold"><div class="stat-num">${tMeds-tTaken}</div><div class="stat-label">Doses Remaining</div></div>
    <div class="stat-card blue"><div class="stat-num">${tAppts}</div><div class="stat-label">Appts This Week</div></div>
    <div class="stat-card ${tRefills>0?'red':'green'}"><div class="stat-num">${tRefills}</div><div class="stat-label">Refills Due Soon</div></div>
    <div class="stat-card"><div class="stat-num">${members.length}</div><div class="stat-label">Family Members</div></div>`;
}

// ‚îÄ‚îÄ BANNERS ‚îÄ‚îÄ
function renderBanners(){
  const soon=[];
  members.forEach(m=>m.appointments.forEach(a=>{const d=daysUntil(a.date);if(d>=0&&d<=3)soon.push({m,a,d})}));
  document.getElementById('banner-area').innerHTML=soon.map(x=>`
    <div class="banner">
      <div class="banner-icon">${x.d===0?'üè•':'üìÖ'}</div>
      <div class="banner-text"><strong>${x.d===0?'Today':'In '+x.d+' day'+(x.d!==1?'s':'')}:</strong> ${x.m.name} ‚Äî <strong>${x.a.title}</strong>${x.a.doctor?' with '+x.a.doctor:''}${x.a.time?' at '+fmtTime(x.a.time):''}${x.a.location?', '+x.a.location:''}${x.a.notes?'<br><span style="color:var(--text3)">üìå '+x.a.notes+'</span>':''}</div>
    </div>`).join('');
}

// ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ
function renderDashboard(){
  renderStats();renderBanners();
  const grid=document.getElementById('family-grid');
  if(!members.length){grid.innerHTML=`<div class="empty" style="grid-column:1/-1"><div class="empty-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div><h4>No family members yet</h4><p>Click "+ Add Member" to get started</p></div>`;return}
  grid.innerHTML=members.map(m=>{
    const total=m.meds.length,taken=m.meds.filter(x=>x.taken).length;
    const pct=total>0?Math.round(taken/total*100):0;
    const s=getMedStatus(m);
    const sc=s==='all'?'status-all':s==='missed'?'status-missed':'status-pending';
    const sl=s==='all'?'All Taken ‚úì':s==='missed'?'Not Started':'In Progress';
    const pc=s==='all'?'green':s==='missed'?'red':'yellow';
    const urgentMissed=m.meds.some(x=>!x.taken&&x.urgent==='high');
    const lowRefill=m.meds.filter(x=>x.supply!=null&&x.supply<=14);
    const upAppts=m.appointments.filter(x=>{const d=daysUntil(x.date);return d>=0&&d<=7});
    const pillHtml=m.meds.slice(0,3).map(x=>`<span class="med-pill ${x.taken?'taken':''}">${x.taken?'‚úì':'‚óã'} ${x.name}</span>`).join('')+(m.meds.length>3?`<span class="med-pill">+${m.meds.length-3} more</span>`:'');
    const apptHtml=upAppts.slice(0,2).map(a=>{const d=daysUntil(a.date);const col=d===0?'var(--gold)':d<=2?'var(--blue)':'var(--accent)';return`<div class="strip-item"><span class="strip-dot" style="background:${col}"></span>${d===0?'Today':d===1?'Tomorrow':'In '+d+' days'}: ${a.title}</div>`}).join('');
    return`<div class="member-card" onclick="openDetail(${m.id})">
      <div class="member-card-header">
        <div class="avatar" style="background:${m.color}">${m.avatar}</div>
        <div style="flex:1"><div class="member-name">${m.name}</div><div class="member-role">${m.role} ¬∑ ${total} med${total!==1?'s':''}</div></div>
        <span class="status-badge ${sc}">${sl}</span>
      </div>
      ${total>0?`<div class="med-progress"><div class="progress-label"><span>${taken} of ${total} taken</span><span>${pct}%</span></div><div class="progress-bar"><div class="progress-fill ${pc}" style="width:${pct}%"></div></div></div><div class="med-pills">${pillHtml}</div>`:'<div style="padding:0 20px 10px;font-size:13px;color:var(--text3)">No medications added</div>'}
      ${upAppts.length?`<div class="card-strip">${apptHtml}</div>`:''}
      ${lowRefill.length?`<div style="padding:0 20px 8px;font-size:12px;color:var(--red);font-weight:500">‚ö†Ô∏è Refill needed: ${lowRefill.map(x=>x.name).join(', ')}</div>`:''}
      <div class="card-actions">
        <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation();openDetail(${m.id})">View Details</button>
        ${s!=='all'?`<button class="btn btn-remind btn-sm" onclick="event.stopPropagation();remind(${m.id})">üîî Remind</button>`:''}
        ${urgentMissed?`<span style="font-size:11px;color:var(--red);font-weight:600;margin-left:auto;display:flex;align-items:center;gap:4px"><span class="urgency-dot high"></span>Urgent meds</span>`:''}
      </div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ
function openDetail(id){
  currentMember=id;
  document.getElementById('detail-tab').style.display='block';
  const m=members.find(x=>x.id===id);
  document.getElementById('detail-avatar-wrap').innerHTML=`<div style="width:50px;height:50px;border-radius:14px;background:${m.color};display:flex;align-items:center;justify-content:center;font-size:25px">${m.avatar}</div>`;
  document.getElementById('detail-name').textContent=m.name;
  document.getElementById('detail-sub').textContent=`${m.role} ¬∑ ${m.meds.length} medication${m.meds.length!==1?'s':''} ¬∑ ${m.appointments.length} appointment${m.appointments.length!==1?'s':''}`;
  switchMain('detail',document.getElementById('detail-tab'));
  renderAllDetail(id);
}

function renderAllDetail(id){renderMeds(id);renderAppts(id);renderRefills(id);renderAllergies(id);renderNotes(id)}

function renderMeds(id){
  const m=members.find(x=>x.id===id);
  const el=document.getElementById('detail-med-list');
  if(!m.meds.length){el.innerHTML=`<div class="empty"><div class="empty-icon">üíä</div><h4>No medications</h4><p>Click "+ Add Medication" to get started</p></div>`;return}
  const ic=['blue','green','gold','red','purple'],em=['üíä','üíâ','ü©∫','üß™','ü©π'];
  el.innerHTML=`<div class="med-list">${m.meds.map((med,i)=>{
    const ium=!med.taken&&med.urgent==='high';
    return`<div class="med-item ${med.taken?'taken-item':''}">
      <div class="med-icon ${ic[i%5]}">${em[i%5]}</div>
      <div class="med-details">
        <div class="med-name">${med.name}</div>
        <div class="med-meta"><span>üíä ${med.dose}</span><span>üîÑ ${med.freq}</span>${med.time?`<span>üïê ${fmtTime(med.time)}</span>`:''}${med.doctor?`<span>üë®‚Äç‚öïÔ∏è ${med.doctor}</span>`:''}</div>
      </div>
      ${med.time?`<span class="time-badge ${ium?'urgent':''}">${fmtTime(med.time)}</span>`:''}
      <button class="check-btn ${med.taken?'checked':''}" onclick="toggleMed(${id},${med.id})">${med.taken?'‚úì':''}</button>
      <button class="btn btn-danger btn-sm" style="margin-left:4px" onclick="delMed(${id},${med.id})">üóë</button>
    </div>`;
  }).join('')}</div>`;
}

function renderAppts(id){
  const m=members.find(x=>x.id===id);
  const el=document.getElementById('detail-appt-list');
  if(!m.appointments.length){el.innerHTML=`<div class="empty"><div class="empty-icon">üìÖ</div><h4>No appointments yet</h4><p>Click "+ Add Appointment" to schedule one</p></div>`;return}
  const sorted=[...m.appointments].sort((a,b)=>new Date(a.date)-new Date(b.date));
  el.innerHTML=`<div class="appt-list">${sorted.map(a=>apptCard(a,false)).join('')}</div>`;
}

function apptCard(a,showMember,memberInfo){
  const d=daysUntil(a.date),dt=new Date(a.date+'T12:00:00');
  const isT=d===0,isPast=d<0;
  const cls=isT?'today':isPast?'past':'upcoming';
  const tag=tagInfo(a.type);
  const dLabel=isT?`<span style="font-size:11px;font-weight:700;color:var(--gold)">TODAY</span>`:isPast?`<span style="font-size:11px;color:var(--text3)">${Math.abs(d)} day${Math.abs(d)!==1?'s':''} ago</span>`:`<span style="font-size:11px;color:var(--blue)">In ${d} day${d!==1?'s':''}</span>`;
  const memberBadge=showMember&&memberInfo?`<div style="display:flex;align-items:center;gap:7px;margin-bottom:6px"><div style="width:22px;height:22px;background:${memberInfo.color};border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px">${memberInfo.avatar}</div><span style="font-size:12px;font-weight:600;color:var(--text2)">${memberInfo.name}</span></div>`:'';
  const delBtn=showMember?'':`<button class="btn btn-danger btn-sm" onclick="delAppt(${currentMember},${a.id})">üóë</button>`;
  return`<div class="appt-card ${cls}">
    <div class="date-block ${isT?'today':'normal'}">
      <div class="date-day ${isT?'today-c':'normal'}">${dt.getDate()}</div>
      <div class="date-mon ${isT?'today-c':'normal'}">${dt.toLocaleDateString('en-US',{month:'short'})}</div>
    </div>
    <div class="appt-info">
      ${memberBadge}
      <div class="appt-title">${a.title}</div>
      <div class="appt-meta">${a.doctor?`<span>üë®‚Äç‚öïÔ∏è ${a.doctor}</span>`:''}${a.location?`<span>üìç ${a.location}</span>`:''}${a.time?`<span>üïê ${fmtTime(a.time)}</span>`:''}</div>
      ${a.notes?`<div style="font-size:12px;color:var(--text3);margin-top:5px">üìå ${a.notes}</div>`:''}
      <div style="margin-top:7px;display:flex;align-items:center;gap:8px"><span class="appt-tag ${tag.c}">${tag.l}</span>${dLabel}</div>
    </div>
    ${delBtn}
  </div>`;
}

function renderRefills(id){
  const m=members.find(x=>x.id===id);
  const el=document.getElementById('detail-refill-list');
  const ws=m.meds.filter(x=>x.supply!=null&&x.supply!=='');
  if(!ws.length){el.innerHTML=`<div class="empty"><div class="empty-icon">üîÑ</div><h4>No refill data</h4><p>Add "Days of Supply" when adding a medication</p></div>`;return}
  el.innerHTML=[...ws].sort((a,b)=>a.supply-b.supply).map(med=>{
    const cls=med.supply<=7?'critical':med.supply<=14?'low':'';
    const nc=med.supply<=7?'critical':med.supply<=14?'low':'ok';
    return`<div class="refill-item ${cls}">
      <div style="flex:1"><div style="font-size:14px;font-weight:600">${med.name} <span style="font-weight:400;color:var(--text3);font-size:13px">${med.dose}</span></div><div style="font-size:12px;color:var(--text3);margin-top:2px">${med.freq}${med.doctor?' ¬∑ '+med.doctor:''}</div></div>
      <div style="text-align:right;margin-right:12px"><div class="refill-num ${nc}">${med.supply}</div><div style="font-size:11px;color:var(--text3)">days left</div></div>
      ${med.supply<=14?`<button class="btn btn-remind btn-sm" onclick="toast('üìû','Request refill for '+${JSON.stringify(med.name)})">Request Refill</button>`:'<span style="font-size:12px;color:var(--accent);font-weight:600">‚úì OK</span>'}
    </div>`;
  }).join('');
}

function renderAllergies(id){
  const m=members.find(x=>x.id===id);
  const el=document.getElementById('detail-allergy-list');
  if(!m.allergies.length){el.innerHTML=`<div class="empty"><div class="empty-icon">‚úÖ</div><h4>No known allergies</h4><p>Add drug or food allergies for safety</p></div>`;return}
  el.innerHTML=`<div class="allergy-list">${m.allergies.map(a=>`
    <div class="allergy-card">
      <div style="font-size:20px">${a.severity==='severe'?'üö®':a.severity==='moderate'?'‚ö†Ô∏è':'‚ÑπÔ∏è'}</div>
      <div><div style="font-size:14px;font-weight:600">${a.name}</div><div style="font-size:12px;color:var(--text3);margin-top:2px">${a.reaction}</div></div>
      <span class="sev-badge ${a.severity}">${a.severity}</span>
      <button class="btn btn-danger btn-sm" style="margin-left:auto" onclick="delAllergy(${id},${a.id})">üóë</button>
    </div>`).join('')}</div>`;
}

function renderNotes(id){
  const m=members.find(x=>x.id===id);
  const vitals=m.notes.filter(n=>n.vType&&n.vVal);
  document.getElementById('detail-vitals').innerHTML=vitals.map(n=>`
    <div class="vital-card">
      <div style="font-size:20px;margin-bottom:4px">${vIcons[n.vType]||'üìä'}</div>
      <div class="vital-val">${n.vVal}</div>
      <div class="vital-lbl">${vLabels[n.vType]||n.vType}</div>
      <div class="vital-date">${n.date}</div>
    </div>`).join('');
  const el=document.getElementById('detail-notes-list');
  if(!m.notes.length){el.innerHTML=`<div class="empty"><div class="empty-icon">üìã</div><h4>No health notes</h4><p>Add notes from doctor visits, vitals, or anything health-related</p></div>`;return}
  el.innerHTML=`<div class="notes-list">${m.notes.map(n=>`
    <div class="note-card">
      <div class="note-head">
        <div class="note-title-text">${n.title}</div>
        <div style="display:flex;align-items:center;gap:8px"><span class="note-date">${n.date}</span><button class="btn btn-danger btn-sm" onclick="delNote(${id},${n.id})">üóë</button></div>
      </div>
      <div class="note-body">${n.body}</div>
    </div>`).join('')}</div>`;
}

// ‚îÄ‚îÄ ALL APPTS PAGE ‚îÄ‚îÄ
function renderAllAppts(){
  const all=[];
  members.forEach(m=>m.appointments.forEach(a=>all.push({...a,memberInfo:{name:m.name,avatar:m.avatar,color:m.color}})));
  all.sort((a,b)=>new Date(a.date)-new Date(b.date));
  const el=document.getElementById('all-appts-list');
  if(!all.length){el.innerHTML=`<div class="empty"><div class="empty-icon">üìÖ</div><h4>No appointments yet</h4><p>Open a member's profile to add appointments</p></div>`;return}
  el.innerHTML=`<div class="appt-list">${all.map(a=>apptCard(a,true,a.memberInfo)).join('')}</div>`;
}

// ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ
function toggleMed(mid,medId){const m=members.find(x=>x.id===mid);const med=m.meds.find(x=>x.id===medId);med.taken=!med.taken;renderMeds(mid);toast(med.taken?'‚úÖ':'‚Ü©Ô∏è',med.taken?`${med.name} marked as taken`:`${med.name} unmarked`)}
function delMed(mid,medId){const m=members.find(x=>x.id===mid);const n=m.meds.find(x=>x.id===medId).name;m.meds=m.meds.filter(x=>x.id!==medId);renderMeds(mid);renderRefills(mid);toast('üóëÔ∏è',`${n} removed`)}
function delAppt(mid,apptId){const m=members.find(x=>x.id===mid);m.appointments=m.appointments.filter(x=>x.id!==apptId);renderAppts(mid);toast('üóëÔ∏è','Appointment removed')}
function delAllergy(mid,alId){const m=members.find(x=>x.id===mid);m.allergies=m.allergies.filter(x=>x.id!==alId);renderAllergies(mid);toast('üóëÔ∏è','Allergy removed')}
function delNote(mid,nId){const m=members.find(x=>x.id===mid);m.notes=m.notes.filter(x=>x.id!==nId);renderNotes(mid);toast('üóëÔ∏è','Note removed')}
function remind(mid){const m=members.find(x=>x.id===mid);const p=m.meds.filter(x=>!x.taken).map(x=>x.name).join(', ');toast('üîî',`Reminder sent to ${m.name}: ${p||'take your medications'}`)}

// ‚îÄ‚îÄ ADD ‚îÄ‚îÄ
function addMember(){
  const name=document.getElementById('nm-name').value.trim();
  if(!name){alert('Enter a name');return}
  const colors=['#dbeafe','#fde8f5','#d8f3dc','#fef9c3','#f3e8ff','#ffe4e6'];
  members.push({id:nid++,name,role:document.getElementById('nm-role').value,avatar:document.getElementById('nm-avatar').value,color:colors[members.length%colors.length],meds:[],appointments:[],allergies:[],notes:[]});
  closeModal('modal-member');renderDashboard();toast('üëã',`${name} added`);
}
function addMed(){
  const name=document.getElementById('med-name').value.trim();
  if(!name){alert('Enter medication name');return}
  const s=document.getElementById('med-supply').value;
  const m=members.find(x=>x.id===currentMember);
  m.meds.push({id:nid++,name,dose:document.getElementById('med-dose').value||'As prescribed',freq:document.getElementById('med-freq').value,time:document.getElementById('med-time').value,urgent:document.getElementById('med-urgent').value,taken:false,supply:s?parseInt(s):null,doctor:document.getElementById('med-doctor').value});
  closeModal('modal-med');renderMeds(currentMember);renderRefills(currentMember);toast('üíä',`${name} added`);
}
function addAppt(){
  const title=document.getElementById('appt-title').value.trim(),date=document.getElementById('appt-date').value;
  if(!title||!date){alert('Enter title and date');return}
  const m=members.find(x=>x.id===currentMember);
  m.appointments.push({id:nid++,title,doctor:document.getElementById('appt-doctor').value,location:document.getElementById('appt-location').value,date,time:document.getElementById('appt-time').value,type:document.getElementById('appt-type').value,notes:document.getElementById('appt-notes').value});
  closeModal('modal-appt');renderAppts(currentMember);toast('üìÖ','Appointment added');
}
function addAllergy(){
  const name=document.getElementById('al-name').value.trim();
  if(!name){alert('Enter allergen name');return}
  const m=members.find(x=>x.id===currentMember);
  m.allergies.push({id:nid++,name,severity:document.getElementById('al-sev').value,reaction:document.getElementById('al-reaction').value||'Unknown reaction'});
  closeModal('modal-allergy');renderAllergies(currentMember);toast('‚ö†Ô∏è','Allergy added');
}
function addNote(){
  const title=document.getElementById('nt-title').value.trim();
  if(!title){alert('Enter a title');return}
  const m=members.find(x=>x.id===currentMember);
  const now=new Date().toLocaleDateString('en-US',{month:'short',day:'numeric'});
  m.notes.unshift({id:nid++,title,body:document.getElementById('nt-body').value,date:now,vType:document.getElementById('nt-vital-type').value,vVal:document.getElementById('nt-vital-val').value});
  closeModal('modal-note');renderNotes(currentMember);toast('üìã','Note saved');
}

// ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ
function openAddMember(){document.getElementById('nm-name').value='';document.getElementById('modal-member').classList.add('open');setTimeout(()=>document.getElementById('nm-name').focus(),100)}
function openAddMed(){['med-name','med-dose','med-supply','med-time','med-doctor'].forEach(i=>document.getElementById(i).value='');document.getElementById('modal-med').classList.add('open');setTimeout(()=>document.getElementById('med-name').focus(),100)}
function openAddAppt(){['appt-title','appt-doctor','appt-location','appt-date','appt-time','appt-notes'].forEach(i=>document.getElementById(i).value='');document.getElementById('modal-appt').classList.add('open');setTimeout(()=>document.getElementById('appt-title').focus(),100)}
function openAddAllergy(){['al-name','al-reaction'].forEach(i=>document.getElementById(i).value='');document.getElementById('modal-allergy').classList.add('open');setTimeout(()=>document.getElementById('al-name').focus(),100)}
function openAddNote(){['nt-title','nt-body','nt-vital-val'].forEach(i=>document.getElementById(i).value='');document.getElementById('nt-vital-type').value='';document.getElementById('modal-note').classList.add('open');setTimeout(()=>document.getElementById('nt-title').focus(),100)}
function closeModal(id){document.getElementById(id).classList.remove('open')}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
function goBack(){switchMain('dashboard',document.querySelectorAll('.tab')[0]);document.getElementById('detail-tab').style.display='none';renderDashboard()}
function switchMain(name,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  btn.classList.add('active');
  if(name==='appointments')renderAllAppts();
  if(name==='dashboard')renderDashboard();
}
function switchDetail(name,btn){
  document.querySelectorAll('.detail-section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.detail-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('ds-'+name).classList.add('active');
  btn.classList.add('active');
}
function toast(icon,msg){
  document.getElementById('t-icon').textContent=icon;
  document.getElementById('t-msg').textContent=msg;
  const t=document.getElementById('toast');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3000);
}

renderDashboard();
</script>
</body>
</html>
